---
import { Image } from "astro:assets";
import { getLocalizedSettings } from "@/lib/localization-helpers";
import { translatePath, unlocalizedUrl } from "@/lib/localization-helpers";
import { defaultLocale, locales } from "site";

const currentLocale = Astro.currentLocale;

function getTranslatedUrl(locale: string): string {
  const unlocalizedPath = unlocalizedUrl(Astro.url.pathname);
  return translatePath(locale, unlocalizedPath);
}

function isActiveLocale(locale: string): boolean {
  return locale === currentLocale;
}

const { header, contacts } = getLocalizedSettings(currentLocale);

const logoPath = header.logo?.imagePath;

const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/global/**/*.{webp,jpeg,jpg,png,gif,svg}"
);
---

<style>
  .menu-icon {
    position: relative;
    width: 50px;
    height: 50px;
    cursor: pointer;
  }
  .menu-icon .menu-icon__checkbox {
    display: block;
    width: 100%;
    height: 100%;
    position: relative;
    cursor: pointer;
    z-index: 2;
    -webkit-touch-callout: none;
    position: absolute;
    opacity: 0;
  }
  .menu-icon div {
    margin: auto;
    position: absolute;
    top: 0;
    right: 0;
    left: 0;
    bottom: 0;
    width: 22px;
    height: 12px;
  }
  .menu-icon span {
    position: absolute;
    display: block;
    width: 100%;
    height: 2px;
    background-color: var(--bar-bg, #000);
    border-radius: 5rem;
    transition: all 0.2s cubic-bezier(0.1, 0.82, 0.76, 0.965);
  }
  .menu-icon span:first-of-type {
    top: 0;
  }
  .menu-icon span:last-of-type {
    bottom: 0;
  }
  .menu-icon.active span:first-of-type,
  .menu-icon .menu-icon__checkbox:checked + div span:first-of-type {
    transform: rotate(45deg);
    top: 5px;
  }
  .menu-icon.active span:last-of-type,
  .menu-icon .menu-icon__checkbox:checked + div span:last-of-type {
    transform: rotate(-45deg);
    bottom: 5px;
  }
  .menu-icon.active:hover span:first-of-type,
  .menu-icon.active:hover span:last-of-type,
  .menu-icon:hover .menu-icon__checkbox:checked + div span:first-of-type,
  .menu-icon:hover .menu-icon__checkbox:checked + div span:last-of-type {
    width: 22px;
  }
  @media (min-width: 1024px) {
    .menu-icon:hover span:first-of-type {
      width: 26px;
    }
    .menu-icon:hover span:last-of-type {
      width: 12px;
    }
  }
  #navigation {
    pointer-events: none;
  }
  [data-nav-border-reveal] {
    --tw-border-opacity: 0;
  }
  .active-locale {
    font-weight: bolder;
  }
</style>

<style is:global>
  [data-nav-text-reveal] {
    opacity: 0;
  }
  [data-nav-text-reveal] > div {
    position: relative;
    margin: 0;
  }
  .split-parent {
    overflow: hidden;
  }
  .split-child {
    display: inline-block;
  }
</style>

<header class="fixed w-full z-30">
  <div
    class="items-center auto-cols-fr grid-cols-2 lg:grid-cols-2 grid-rows-[auto] justify-between left-0 py-3.5 px-6 lg:px-20 right-0 top-0 grid gap-4"
  >
    <div
      class="items-center flex-wrap justify-start relative flex text-blue-700 z-20"
    >
      <a
        href={translatePath(currentLocale ?? defaultLocale, "/")}
        id="header-logo"
        class="text-blue-700 justify-self-start lg:justify-self-center underline inline-block max-w-full"
      >
        <!--?xml version="1.0" standalone="no"?-->

        <svg
          version="1.0"
          id="CompanyLogo"
          xmlns="http://www.w3.org/2000/svg"
          width="400.000000pt"
          height="80.000000pt"
          viewBox="0 0 1460.000000 286.000000"
          preserveAspectRatio="xMidYMid meet"
        >
          <g
            transform="translate(0.000000,286.000000) scale(0.100000,-0.100000)"
            fill="#000000"
            stroke="none"
          >
            <path
              d="M3526 2097 c-12 -9 -17 -23 -14 -47 l3 -35 67 -3 c46 -2 70 -8 80
			-19 10 -13 13 -92 10 -404 -1 -221 -6 -399 -12 -413 -9 -24 -14 -26 -75 -26
			-61 0 -66 -2 -75 -25 -10 -26 -4 -55 14 -67 5 -3 99 -7 208 -7 189 0 199 1
			218 22 16 17 20 18 20 5 0 -9 8 -19 18 -22 31 -8 396 -4 415 5 21 12 23 62 3
			78 -8 7 -38 11 -66 10 -82 -4 -80 -14 -80 346 0 229 -3 314 -12 323 -17 17
			-239 16 -260 0 -20 -17 -27 -39 -18 -63 6 -17 18 -21 76 -25 l69 -5 12 -45
			c15 -60 15 -420 0 -480 l-12 -45 -69 -5 c-57 -4 -70 -8 -76 -25 -7 -19 -7 -19
			-19 3 -11 20 -19 23 -68 21 -90 -4 -85 -34 -81 496 l3 460 -131 2 c-93 2 -136
			-1 -148 -10z"
            ></path>
            <path
              d="M4134 2076 c-65 -29 -62 -128 5 -155 61 -26 121 12 121 77 0 66 -64
			105 -126 78z"
            ></path>
            <path
              d="M8780 2077 c-28 -14 -50 -51 -50 -85 0 -34 52 -82 88 -82 93 0 123
			130 37 165 -41 18 -43 18 -75 2z"
            ></path>
            <path
              d="M12084 2076 c-55 -24 -66 -107 -21 -144 8 -7 31 -16 51 -19 30 -5 40
			-1 66 25 37 37 40 80 8 116 -29 32 -64 39 -104 22z"
            ></path>
            <path
              d="M2300 2072 c-32 -9 -40 -36 -40 -126 0 -50 -4 -96 -8 -102 -4 -6 -28
			-13 -54 -16 -58 -7 -78 -22 -78 -58 0 -37 21 -52 80 -58 28 -2 51 -5 52 -6 1
			0 4 -122 7 -271 6 -282 8 -292 55 -343 39 -44 76 -56 161 -56 167 1 233 79
			236 281 1 95 -8 113 -57 113 -43 0 -50 -15 -57 -122 -6 -108 -26 -149 -80
			-162 -51 -13 -86 1 -111 44 -20 33 -21 51 -21 275 l0 240 100 6 c123 8 141 13
			149 45 5 19 -5 58 -17 65 -1 1 -54 4 -117 8 l-115 6 -3 104 c-1 58 -7 110 -13
			117 -11 14 -48 22 -69 16z"
            ></path>
            <path
              d="M8178 2073 c-23 -6 -29 -30 -37 -142 l-6 -96 -46 -5 c-57 -7 -79 -24
			-79 -60 0 -36 18 -50 77 -58 l48 -7 7 -255 c5 -140 13 -272 18 -293 6 -20 26
			-53 45 -71 60 -60 185 -71 283 -24 71 34 112 132 112 269 0 79 -11 99 -55 99
			-45 0 -53 -16 -64 -136 -8 -92 -10 -100 -40 -126 -36 -32 -84 -37 -120 -12
			-46 32 -51 66 -51 319 l0 235 98 0 c117 0 146 11 150 59 2 18 -2 39 -8 45 -6
			6 -60 13 -123 16 l-112 5 -7 110 c-8 130 -20 147 -90 128z"
            ></path>
            <path
              d="M11472 2064 c-20 -14 -22 -23 -22 -112 0 -53 -4 -102 -8 -108 -4 -6
			-28 -13 -54 -16 -58 -7 -78 -22 -78 -58 0 -36 15 -47 75 -57 l50 -8 7 -247 c7
			-264 14 -310 54 -358 43 -50 79 -64 169 -64 67 -1 87 3 125 24 80 45 110 118
			110 268 0 88 -8 102 -57 102 -42 0 -49 -14 -57 -122 -7 -101 -19 -134 -57
			-154 -71 -36 -142 3 -154 87 -3 24 -5 139 -3 254 l3 210 113 6 c62 3 118 11
			124 17 15 15 14 70 -1 85 -7 7 -56 14 -124 17 l-112 5 -6 109 c-4 91 -8 111
			-24 122 -24 18 -45 18 -73 -2z"
            ></path>
            <path
              d="M1551 1845 c-99 -28 -165 -87 -182 -163 -11 -49 7 -104 39 -121 33
			-18 90 -13 112 9 24 24 27 82 5 100 -24 20 -18 35 24 58 121 68 271 12 271
			-102 0 -52 -26 -90 -73 -105 -17 -6 -79 -17 -137 -26 -58 -8 -127 -22 -154
			-31 -160 -53 -198 -264 -67 -375 52 -45 103 -61 199 -60 91 0 157 21 208 65
			l38 33 21 -31 c30 -44 69 -61 146 -60 118 0 151 42 153 192 1 87 -1 95 -23
			113 -28 23 -32 23 -56 6 -14 -11 -20 -33 -25 -102 -7 -89 -20 -115 -57 -115
			-34 0 -41 42 -47 290 -4 135 -11 263 -17 283 -14 51 -64 106 -118 130 -59 26
			-188 32 -260 12z m259 -553 c-22 -99 -97 -155 -210 -156 -76 0 -122 20 -145
			64 -31 60 -10 126 50 154 19 10 84 25 143 35 60 10 122 25 138 34 l29 15 3
			-46 c2 -26 -2 -71 -8 -100z"
            ></path>
            <path
              d="M3031 1845 c-30 -9 -69 -24 -86 -35 -50 -31 -114 -106 -141 -164 -52
			-114 -54 -304 -5 -419 26 -61 97 -136 158 -167 42 -22 61 -25 158 -25 104 0
			114 2 177 33 83 41 142 104 158 170 14 60 2 97 -34 106 -40 10 -63 -8 -81 -65
			-35 -104 -138 -162 -249 -139 -100 21 -183 121 -189 228 l-2 47 275 5 c151 3
			281 9 288 13 16 11 15 118 -2 184 -25 94 -94 176 -181 214 -60 26 -176 33
			-244 14z m184 -114 c51 -23 101 -79 116 -130 22 -73 25 -72 -208 -69 l-208 3
			-3 27 c-4 33 16 73 60 117 67 68 163 89 243 52z"
            ></path>
            <path
              d="M4723 1845 c-188 -53 -291 -242 -263 -485 16 -139 80 -243 184 -298
			47 -25 61 -27 166 -27 108 0 119 2 173 30 33 16 78 51 102 77 68 75 83 178 29
			198 -43 17 -69 -3 -93 -70 -17 -47 -32 -68 -63 -90 -146 -106 -332 -21 -367
			167 -5 25 -7 52 -4 60 4 10 55 13 247 14 132 0 259 3 281 7 l40 8 0 89 c-1 70
			-6 101 -22 137 -30 66 -104 142 -163 167 -65 28 -179 36 -247 16z m183 -114
			c50 -23 112 -93 120 -138 12 -64 16 -63 -210 -63 -134 0 -207 4 -211 11 -17
			27 8 83 59 135 75 74 158 93 242 55z"
            ></path>
            <path
              d="M5610 1845 c-25 -8 -65 -31 -88 -50 l-42 -37 0 30 c0 18 -6 32 -16
			36 -30 11 -229 7 -242 -6 -7 -7 -12 -27 -12 -44 0 -38 20 -48 91 -45 42 2 47
			-1 57 -26 13 -36 26 -388 16 -471 -9 -80 -19 -91 -83 -84 -33 3 -56 0 -66 -8
			-22 -18 -19 -67 4 -80 26 -13 396 -13 422 0 23 13 26 62 4 80 -10 8 -33 11
			-65 8 -80 -8 -84 1 -88 198 -6 252 17 341 96 387 41 24 117 25 160 3 62 -32
			83 -105 33 -113 -81 -12 -82 -110 -2 -134 33 -10 45 -9 78 7 49 24 73 72 73
			144 -1 103 -55 176 -156 206 -58 17 -115 17 -174 -1z"
            ></path>
            <path
              d="M6593 1845 c-185 -52 -281 -233 -253 -475 15 -132 62 -223 145 -280
			66 -46 117 -60 211 -60 116 0 182 26 254 100 91 92 129 231 109 398 -18 144
			-105 268 -217 307 -67 23 -185 28 -249 10z m218 -122 c46 -24 58 -36 84 -87
			29 -57 30 -65 30 -190 0 -123 -2 -134 -27 -182 -64 -121 -196 -165 -308 -102
			-78 44 -121 139 -122 275 0 90 14 151 48 210 58 100 182 132 295 76z"
            ></path>
            <path
              d="M7555 1851 c-58 -16 -84 -30 -124 -67 l-41 -36 0 35 c0 23 -6 37 -16
			41 -26 10 -224 7 -245 -4 -23 -13 -26 -62 -5 -79 8 -7 39 -11 71 -10 40 2 59
			-2 66 -12 5 -8 9 -189 9 -404 0 -455 2 -442 -79 -437 -60 4 -81 -8 -81 -47 0
			-49 9 -51 227 -51 l203 0 10 26 c7 17 7 32 0 45 -11 20 -19 22 -90 23 -42 1
			-46 3 -57 36 -6 19 -12 73 -12 119 l-1 83 35 -26 c51 -39 108 -56 191 -56 204
			0 330 135 350 377 22 259 -101 436 -313 448 -37 2 -81 0 -98 -4z m161 -121
			c74 -36 112 -115 121 -250 13 -189 -57 -315 -188 -341 -69 -14 -126 0 -175 43
			-63 55 -69 76 -68 233 0 79 6 159 13 183 35 122 182 187 297 132z"
            ></path>
            <path
              d="M9469 1845 c-25 -8 -63 -30 -84 -48 l-40 -35 -10 32 -10 31 -117 3
			c-116 3 -117 2 -134 -23 -14 -21 -15 -31 -6 -50 11 -23 17 -25 76 -25 54 0 67
			-3 76 -19 6 -12 10 -118 10 -273 0 -299 0 -301 -79 -291 -28 3 -57 1 -69 -6
			-14 -8 -23 -8 -27 -1 -4 6 -33 10 -67 9 -42 -2 -62 2 -68 11 -18 28 -22 118
			-18 381 3 231 1 271 -12 279 -8 5 -67 10 -131 10 -100 0 -118 -3 -132 -18 -20
			-22 -22 -55 -4 -70 7 -6 39 -12 72 -14 52 -3 61 -6 72 -28 17 -33 18 -472 2
			-519 -11 -30 -12 -31 -75 -31 -59 0 -65 -2 -76 -25 -8 -18 -8 -31 0 -49 l11
			-24 203 0 c127 0 208 4 216 11 9 7 16 7 24 -1 15 -15 381 -17 409 -2 12 7 19
			21 19 40 0 37 -29 54 -81 47 -24 -3 -42 0 -48 7 -16 19 -24 249 -13 362 11
			113 34 170 80 203 70 50 190 45 236 -9 42 -51 56 -219 38 -463 -8 -99 -14
			-107 -73 -100 -24 4 -45 1 -54 -7 -18 -15 -20 -64 -2 -78 8 -7 83 -11 200 -11
			l188 0 11 24 c9 19 7 29 -5 49 -14 20 -26 25 -69 28 -46 3 -53 6 -59 28 -11
			41 -10 351 2 416 20 109 72 157 174 157 62 0 105 -21 142 -70 l28 -36 3 -228
			c2 -153 0 -235 -8 -248 -8 -17 -20 -21 -58 -21 -54 0 -72 -12 -72 -50 0 -47
			11 -50 210 -50 200 0 210 2 210 52 0 36 -30 52 -86 44 -68 -9 -68 -8 -74 283
			-5 242 -6 258 -28 299 -47 88 -162 140 -285 128 -85 -8 -132 -27 -179 -73
			l-37 -36 -42 41 c-66 67 -175 89 -280 57z"
            ></path>
            <path
              d="M10736 1844 c-119 -38 -178 -102 -179 -197 -1 -42 3 -53 27 -73 39
			-34 98 -33 125 2 25 31 27 63 6 90 -22 30 -18 42 23 63 84 43 185 35 237 -19
			35 -37 45 -108 21 -146 -24 -35 -63 -49 -193 -68 -62 -9 -131 -23 -154 -31
			-106 -38 -154 -111 -147 -226 5 -86 39 -141 113 -178 44 -23 61 -26 160 -26
			95 0 116 3 155 23 25 13 56 35 68 50 16 19 25 23 29 14 27 -70 123 -106 214
			-81 80 22 93 46 97 179 4 106 3 109 -21 124 -48 32 -77 -5 -77 -99 0 -30 -4
			-65 -9 -78 -13 -34 -47 -44 -72 -21 -17 15 -19 32 -20 168 -1 243 -12 374 -37
			423 -23 45 -68 84 -117 103 -51 20 -194 22 -249 4z m271 -484 c-12 -153 -80
			-223 -217 -224 -100 -1 -160 44 -160 118 0 77 47 108 203 134 65 11 128 27
			140 36 12 8 26 15 31 15 5 1 6 -34 3 -79z"
            ></path>
            <path
              d="M11938 1818 c-21 -18 -27 -39 -17 -65 7 -21 15 -23 72 -23 59 0 65
			-2 75 -25 15 -32 16 -492 2 -529 -9 -24 -14 -26 -75 -26 -62 0 -66 -2 -76 -26
			-13 -35 -4 -61 24 -67 47 -10 807 -7 827 3 23 12 27 59 8 78 -7 7 -38 12 -70
			12 -32 0 -58 3 -58 6 0 11 173 205 181 202 4 -2 46 -48 93 -103 l86 -100 -57
			-3 c-32 -2 -63 -8 -70 -14 -20 -16 -16 -66 6 -78 21 -11 368 -14 395 -4 26 10
			37 39 26 68 -9 24 -14 26 -74 26 l-65 0 -83 98 c-46 53 -105 122 -131 154
			l-48 56 111 126 c61 69 120 130 130 136 11 6 46 10 78 8 31 -1 63 1 70 6 19
			11 15 74 -5 85 -10 5 -101 9 -201 9 -163 0 -186 -2 -202 -18 -11 -11 -16 -27
			-13 -44 7 -34 14 -38 69 -38 l45 0 -63 -71 c-34 -40 -69 -80 -79 -90 -16 -18
			-19 -15 -88 66 -39 46 -71 87 -71 90 0 3 18 5 39 4 45 -1 71 16 71 49 0 48
			-16 52 -212 52 -101 0 -191 -4 -200 -10 -21 -10 -24 -58 -6 -76 7 -7 39 -12
			75 -12 l62 0 117 -135 116 -136 -25 -32 c-45 -58 -212 -240 -237 -258 -20 -15
			-47 -19 -139 -21 -101 -2 -115 0 -127 17 -11 15 -14 80 -14 326 0 266 -2 310
			-16 323 -20 21 -231 23 -256 4z"
            ></path>
            <path
              d="M1023 1205 c-57 -40 -46 -142 19 -169 45 -19 83 -10 114 27 52 62 10
			157 -71 157 -22 0 -50 -7 -62 -15z"
            ></path>
          </g>
        </svg>
      </a>
    </div>
    <div class="col-start-2 hidden lg:flex justify-center items-center h-full">
      <a
        data-company-name
        class="pb-4 group"
        href={translatePath(currentLocale ?? defaultLocale, "/")}
      >
        <div
          class="w-20 h-1 bg-slate-200 rounded-full group-hover:bg-slate-600 transition-colors duration-500"
        >
        </div>
      </a>
    </div>
    <div class="justify-self-end col-span-1 row-span-1 z-40 col-start-3">
      <div
        class="items-center justify-center relative flex h-16 lg:w-24 lg:h-24"
      >
        <div class="menu-icon">
          <input id="menu-toggle" class="menu-icon__checkbox" type="checkbox" />
          <div>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <nav
    id="navigation"
    class="items-center bottom-0 text-sm font-medium justify-center left-0 fixed right-0 top-0 flex h-screen z-30"
  >
    <div
      id="navigation-background"
      class="bg-white w-full h-full absolute top-0 left-0 opacity-0"
    >
    </div>
    <div
      class="items-center font-semibold flex-wrap justify-center flex flex-col overflow-hidden z-20 w-full"
    >
      <div class="flex flex-col items-start md:items-center pt-10">
        {
          header.pages.map((page, index) => (
            <a
              data-nav-item
              href={translatePath(currentLocale ?? defaultLocale, page.link)}
              class="items-center justify-start flex overflow-hidden gap-4 relative pr-10"
            >
              <div
                data-nav-border-reveal
                data-nav-text-reveal
                class="text-black items-center cursor-pointer justify-center pt-1 flex w-9 h-9 border-2 border-black border-solid rounded-full"
              >
                0{index + 1}
              </div>
              <div
                data-nav-text-reveal
                class="cursor-pointer overflow-hidden text-4xl xs:text-5xl md:text-[5.63rem] !leading-[1.15] text-black"
              >
                {page.title}
              </div>
            </a>
          ))
        }
        <!-- <div class="flex gap-8 pt-10 pl-16 md:pl-0">
          {
            locales.map((locale) => (
              <a
                href={getTranslatedUrl(locale)}
                class:list={[
                  "items-center justify-start flex overflow-hidden gap-4 relative cursor-pointer",
                  isActiveLocale(locale) && "active-locale",
                ]}
              >
                <span
                  data-nav-text-reveal
                  class="overflow-hidden text-md xs:text-lg md:text-xl !leading-[1.15] text-black"
                >
                  <span>{locale}</span>
                </span>
              </a>
            ))
          }
        </div> -->
      </div>
    </div>
  </nav>
</header>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  // Uncomment if you have premium version of gsap
  // import { SplitText } from "gsap/SplitText";
  // import { DrawSVGPlugin } from "gsap/DrawSVGPlugin";
  import { BlurPlugin } from "@/utils/gsap-blur";
  import { LifecycleManager } from "@/utils/lifecycle-manager";

  gsap.registerPlugin(
    ScrollTrigger,
    /*SplitText, DrawSVGPlugin,*/
    BlurPlugin
  );

  const lm = new LifecycleManager();

  lm.onElementLoaded("navigation", (ctx) => {
    ctx?.add(() => {
      gsap
        .timeline({
          defaults: {
            ease: "power1.inOut",
            stagger: 0.2,
          },
          scrollTrigger: {
            trigger: "body",
            start: "50px",
            toggleActions: "play none none reverse",
          },
        })
        .to("[data-company-name]", { opacity: 0 })
        // .to("header .logo-path-mask", { drawSVG: 0 }, "<")
        .to("header .logo-path-mask", { opacity: 0 }, "<")
        .set("#header-logo", { pointerEvents: "none" });

      const tl = gsap.timeline({
        paused: true,
        defaults: {
          duration: 1,
          ease: "power3.out",
        },
      });

      // const childSplit = new SplitText("[data-nav-text-reveal]", {
      // 	type: "lines",
      // 	linesClass: "split-child",
      // });
      // const parentSplit = new SplitText("[data-nav-text-reveal]", {
      // 	// type: "lines",
      // 	linesClass: "split-parent",
      // });

      tl.set("#navigation", { pointerEvents: "auto" })
        .to("#navigation-background", { opacity: 1 }, "<")
        .to(
          "[data-nav-text-reveal]",
          { opacity: 1, duration: 0.5, ease: "none" },
          "<=0.5"
        );
      // .from(
      // 	childSplit.lines,
      // 	{
      // 		duration: 1,
      // 		yPercent: 300,
      // 		skewY: 7,
      // 		stagger: 0.02,
      // 	},
      // 	"<",
      // );

      const menuItems = gsap.utils.toArray("[data-nav-item]") as HTMLElement[];

      menuItems.forEach((menuItem) => {
        const menuItemTl = gsap
          .timeline({
            defaults: { duration: 0.4, ease: "none" },
            paused: true,
          })
          .to(menuItem, {
            blur: 2,
          })
          .to(menuItem, {
            blur: 1,
          });
        menuItem.addEventListener("mouseenter", (e) => menuItemTl.play());
        menuItem.addEventListener("mouseleave", (e) => menuItemTl.pause(0));
      });

      // Get the checkbox
      const menuToggle = document.getElementById("menu-toggle");

      // Add an event listener to the checkbox
      menuToggle?.addEventListener("change", function () {
        if ((this as HTMLInputElement).checked) {
          tl.play();
        } else {
          tl.reverse();
        }
      });
    });
  });
</script>
